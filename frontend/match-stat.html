<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Add Match Stats - SportsConnect</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <style>
    /* ---------- Reset & Font ---------- */
    *{box-sizing:border-box;margin:0;padding:0;font-family:'Poppins',sans-serif}
    html,body{height:100%}

    /* ---------- Background Gradient (your original animated look) ---------- */
    body{
      background: linear-gradient(135deg,#0f2027,#203a43,#2c5364);
      background-size:200% 200%;
      animation: gradientShift 8s ease infinite;
      color:#fff;
      min-height:100vh;
      display:flex;
      flex-direction:column;
    }
    @keyframes gradientShift{
      0%{background-position:0% 50%}
      50%{background-position:100% 50%}
      100%{background-position:0% 50%}
    }

    /* ---------- Navbar ---------- */
    .navbar{
      background: rgba(255,255,255,0.05);
      backdrop-filter: blur(10px);
      border-bottom:1px solid rgba(255,255,255,0.12);
      display:flex;
      justify-content:space-between;
      align-items:center;
      padding:15px 40px;
      position:sticky;
      top:0;
      z-index:10;
    }
    .navbar a{ color:#fff; text-decoration:none; font-weight:600; margin-left:16px }
    .navbar a:hover{ color:#00e0ff }

    /* ---------- Container & card (glass) ---------- */
    .container{
      flex:1;
      display:flex;
      flex-direction:column;
      align-items:center;
      padding:40px 20px;
    }

    .card{
      width:100%;
      max-width:700px;
      background: rgba(255,255,255,0.08);
      border:1px solid rgba(255,255,255,0.12);
      backdrop-filter: blur(18px);
      padding:28px;
      border-radius:16px;
      box-shadow: 0 12px 30px rgba(0,0,0,0.45);
    }

    .back-link{
      color:#00e0ff;
      text-decoration:none;
      display:inline-block;
      margin-bottom:14px;
      font-weight:600;
    }
    .back-link:hover{ color:#fff }

    .header{ text-align:center; margin-bottom:20px }
    .header h1{
      font-size:2rem;
      margin-bottom:6px;
      background: linear-gradient(90deg,#00e0ff,#5efc82);
      -webkit-background-clip:text; -webkit-text-fill-color:transparent;
    }
    .header p{ color:rgba(255,255,255,0.85) }

    /* ---------- Form ---------- */
    form { width:100% }
    .form-row{ display:flex; gap:16px; align-items:center; }
    .form-group{ margin-bottom:14px; display:flex; flex-direction:column; width:100% }
    label{ font-weight:600; margin-bottom:6px; color: #e8f7ff }

    input[type="text"],
    input[type="number"],
    input[type="date"],
    select {
      padding:10px 12px;
      border-radius:10px;
      border:none;
      outline:none;
      font-size:0.95rem;
    }

    /* ---------- IMPORTANT: make select sport WHITE as requested ---------- */
    /* White background and dark text specifically for the sport select */
    #sport {
      background: #ffffff;
      color: #111827;
      -webkit-appearance: none; /* remove default arrow styling on some browsers */
      -moz-appearance: none;
      appearance: none;
      padding-right: 36px; /* space for custom arrow */
      position: relative;
    }

    /* Make options readable on dark card when opened */
    #sport option { color: #111827; background: #fff }

    /* Add a small white arrow/chevron inside the select area */
    .select-wrapper{
      position:relative;
    }
    .select-wrapper::after{
      content:"\25BE"; /* small down arrow */
      position:absolute;
      right:12px;
      top:50%;
      transform:translateY(-50%);
      pointer-events:none;
      color:#111827;
      font-size:12px;
    }

    /* For other inputs, keep glass/dark style */
    input[type="text"],
    input[type="number"],
    input[type="date"]{
      background: rgba(255,255,255,0.06);
      color: #fff;
    }
    input::placeholder{ color: rgba(255,255,255,0.6) }

    /* dynamic stat fields inside scroll box */
    .scroll-box{
      max-height:260px;
      overflow-y:auto;
      padding-right:8px;
      margin-bottom:12px;
    }
    .scroll-box::-webkit-scrollbar{ width:8px }
    .scroll-box::-webkit-scrollbar-thumb{ background: rgba(255,255,255,0.12); border-radius:8px }

    /* small stat field styles */
    .stat-field{
      display:flex;
      gap:10px;
      align-items:center;
      margin-bottom:10px;
    }
    .stat-field label{ width:45%; color:#e6f7ff }
    .stat-field input{ flex:1; padding:8px 10px; border-radius:8px; background: rgba(255,255,255,0.06); color:#fff; border:none }

    /* Submit */
    .btn{
      width:100%;
      padding:12px;
      border-radius:10px;
      border:none;
      font-weight:700;
      cursor:pointer;
      background: linear-gradient(90deg,#00e0ff,#5efc82);
      color:#000;
    }
    .btn:hover{ transform:translateY(-2px) }

    /* Responsive */
    @media (max-width:640px){
      .form-row{ flex-direction:column }
      .card{ padding:18px }
    }

  </style>
</head>
<body>

  <nav class="navbar">
    <div class="navbar-left">
      <a href="dashboard.html" style="font-weight:800; font-size:1.05rem; color:#fff; text-decoration:none">SportsConnect</a>
    </div>
    <div class="navbar-right">
      <a href="profile.html">Profile</a>
      <a href="#" onclick="logout()">Logout</a>
    </div>
  </nav>

  <div class="container">
    <div class="card">
      <a class="back-link" href="#" onclick="history.back(); return false;">&larr; Go Back</a>

      <div class="header">
        <h1>Add Match Stats</h1>
        <p>Record your performance to track progress and improve.</p>
      </div>

      <form id="statsForm">
        <div class="form-row">
          <div class="form-group" style="flex:1">
            <label for="matchDate">Match Date</label>
            <input id="matchDate" type="date" required />
          </div>

          <div class="form-group" style="flex:1">
            <label for="opponent">Opponent's Team/Name</label>
            <input id="opponent" type="text" placeholder="e.g., Warriors FC" required />
          </div>
        </div>

        <div class="form-row">
          <div class="form-group" style="width:100%">
            <label for="sport">Select Sport</label>
            <div class="select-wrapper">
              <select id="sport" required>
                <option value="" disabled selected>Select Sport</option>
                <option value="Cricket">Cricket</option>
                <option value="Football">Football</option>
                <option value="Basketball">Basketball</option>
                <option value="Tennis">Tennis</option>
                <option value="Volleyball">Volleyball</option>
                <option value="Kabaddi">Kabaddi</option>
                <option value="Hockey">Hockey</option>
                <option value="Badminton">Badminton</option>
                <option value="Baseball">Baseball</option>
                <option value="Table Tennis">Table Tennis</option>
              </select>
            </div>
          </div>
        </div>

        <!-- role select appears when sport selected -->
        <div class="form-row" id="roleRow" style="display:none">
          <div class="form-group" style="width:100%">
            <label for="role">Select Role/Position</label>
            <select id="role">
              <!-- options injected by JS -->
            </select>
          </div>
        </div>

        <!-- dynamic stat fields -->
        <div id="dynamic-stats-fields-wrapper" class="scroll-box">
          <div id="dynamic-stats-fields"></div>
        </div>

        <button type="submit" class="btn">Save Stats</button>
      </form>
    </div>
  </div>

  <script>
    // ---------- role & stat maps (same as earlier) ----------
    const sportRoles = {
      Cricket: ["Batsman","Bowler","All-Rounder","Wicket Keeper"],
      Football: ["Forward","Midfielder","Defender","Goalkeeper"],
      Basketball: ["Guard","Forward","Center"],
      Tennis: ["Singles","Doubles"],
      Volleyball: ["Attacker","Blocker","Setter","Libero"],
      Kabaddi: ["Raider","Defender","All-Rounder"],
      Hockey: ["Forward","Midfielder","Defender","Goalkeeper"],
      Badminton: ["Singles","Doubles"],
      Baseball: ["Pitcher","Catcher","Infielder","Outfielder"],
      "Table Tennis": ["Singles","Doubles"]
    };

    const statsByRole = {
      Cricket: {
        "Batsman":["Runs","Balls Faced","Fours","Sixes","Strike Rate"],
        "Bowler":["Overs","Runs Given","Wickets","Economy"],
        "All-Rounder":["Runs","Wickets","Catches"],
        "Wicket Keeper":["Runs","Catches","Stumpings"]
      },
      Football: {
        "Forward":["Goals","Shots on Target","Assists"],
        "Midfielder":["Assists","Pass Accuracy(%)","Tackles"],
        "Defender":["Clearances","Tackles","Interceptions"],
        "Goalkeeper":["Saves","Goals Conceded","Clean Sheets"]
      },
      Basketball: {
        "Guard":["Points","Assists","Steals"],
        "Forward":["Points","Rebounds","Blocks"],
        "Center":["Rebounds","Blocks","Field Goals %"]
      },
      Tennis: {
        "Singles":["Aces","Double Faults","Winners","Unforced Errors"],
        "Doubles":["Aces","Winners","Volleys","Break Points Won"]
      },
      Volleyball: {
        "Attacker":["Spikes","Aces","Errors"],
        "Blocker":["Blocks","Errors"],
        "Setter":["Assists","Aces"],
        "Libero":["Digs","Receives"]
      },
      Kabaddi: {
        "Raider":["Raid Points","Super Raids"],
        "Defender":["Tackles","Super Tackles"],
        "All-Rounder":["Raid Points","Tackles"]
      },
      Hockey: {
        "Forward":["Goals","Shots","Assists"],
        "Midfielder":["Passes","Interceptions"],
        "Defender":["Tackles","Clearances"],
        "Goalkeeper":["Saves","Goals Conceded"]
      },
      Badminton: {
        "Singles":["Points","Smashes","Rallies Won"],
        "Doubles":["Points","Smashes","Net Play Success"]
      },
      Baseball: {
        "Pitcher":["Innings Pitched","Runs","Strikeouts"],
        "Catcher":["Passed Balls","Catches","Errors"],
        "Infielder":["Putouts","Assists","Errors"],
        "Outfielder":["Putouts","Assists","Errors"]
      },
      "Table Tennis": {
        "Singles":["Points","Smashes","Errors"],
        "Doubles":["Points","Smashes","Net Play Success"]
      }
    };

    // ---------- DOM refs ----------
    const sportEl = document.getElementById('sport');
    const roleRow = document.getElementById('roleRow');
    const roleEl = document.getElementById('role');
    const dynamicFields = document.getElementById('dynamic-stats-fields');
    const statsForm = document.getElementById('statsForm');

    // When sport changes -> populate roles & show role row
    sportEl.addEventListener('change', () => {
      const sport = sportEl.value;
      dynamicFields.innerHTML = ''; // clear stat fields
      roleEl.innerHTML = ''; // clear role options

      if (!sport) {
        roleRow.style.display = 'none';
        return;
      }

      const roles = sportRoles[sport] || [];
      if (roles.length > 0) {
        roleRow.style.display = 'flex';

        // add default option
        const defaultOpt = document.createElement('option');
        defaultOpt.value = '';
        defaultOpt.disabled = true;
        defaultOpt.selected = true;
        defaultOpt.textContent = 'Select Role';
        roleEl.appendChild(defaultOpt);

        roles.forEach(r => {
          const opt = document.createElement('option');
          opt.value = r;
          opt.textContent = r;
          roleEl.appendChild(opt);
        });
      } else {
        roleRow.style.display = 'none';
      }
    });

    // When role changes -> create stat inputs for that sport/role
    roleEl.addEventListener('change', () => {
      dynamicFields.innerHTML = '';
      const sport = sportEl.value;
      const role = roleEl.value;
      if (!sport || !role) return;

      const fields = (statsByRole[sport] && statsByRole[sport][role]) || [];
      if (fields.length === 0) {
        dynamicFields.innerHTML = '<p style="color:rgba(255,255,255,0.8)">No specific stats defined for this role.</p>';
        return;
      }

      fields.forEach(f => {
        const wrapper = document.createElement('div');
        wrapper.className = 'stat-field';

        const lbl = document.createElement('label');
        lbl.textContent = f;

        const input = document.createElement('input');
        // choose number type for numeric stats, text for percent/complex labels
        const numeric = /^(\d|Runs|Balls|Overs|Goals|Points|Assists|Wickets|Saves|Rebounds|Blocks|Smashes|Shots|Tackles|Catches|Strikeouts|Innings)/i;
        // if field likely numeric -> number type, else text
        if (/\%|%|Accuracy|Field Goals|Strike Rate|Economy|Pass Accuracy/i.test(f)) {
          input.type = 'text';
          input.placeholder = `Enter ${f}`;
        } else {
          input.type = 'number';
          input.min = 0;
          input.placeholder = `Enter ${f}`;
        }
        input.name = `stat_${f.replace(/\s+/g,'_')}`;

        wrapper.appendChild(lbl);
        wrapper.appendChild(input);
        dynamicFields.appendChild(wrapper);
      });
    });

    // submit handler - currently just collects values and logs or posts to API
    statsForm.addEventListener('submit', async (e) => {
  e.preventDefault();

  const matchDate = document.getElementById('matchDate').value;
  const opponent = document.getElementById('opponent').value;
  const sport = sportEl.value;
  const role = roleEl.value;

  const statInputs = dynamicFields.querySelectorAll('input');
  const statsObj = {};
  statInputs.forEach(inp => {
    const key = inp.name.replace(/^stat_/, '');
    statsObj[key] = inp.type === 'number' ? (inp.value ? Number(inp.value) : 0) : (inp.value || '');
  });

  const payload = {
    matchDate,
    opponent,
    sport,
    stats: statsObj
  };

  try {
    const token = localStorage.getItem('token');
    const res = await fetch('http://localhost:5000/api/users/me/stats', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': 'Bearer ' + token
      },
      body: JSON.stringify(payload)
    });
    if (!res.ok) throw new Error('Failed to save');

    const data = await res.json();
    alert('âœ… Stats saved successfully!');
    statsForm.reset();
    dynamicFields.innerHTML = '';
    roleRow.style.display = 'none';

    // Optional: redirect back to profile to see new stats
    window.location.href = 'profile.html';
  } catch (err) {
    console.error(err);
    alert('Failed to save stats. See console for details.');
  }
});

    function logout(){
      localStorage.removeItem('token');
      localStorage.removeItem('userId');
      window.location.href = 'index.html';
    }

  </script>
</body>
</html>
